import { useEffect } from "react";
import { useRouter } from "next/router";
import { signIn, signOut, useSession } from "next-auth/react";
import { Guides } from '@/components/Guides';
import { Resources } from '@/components/Resources';
import { HeroPattern } from '@/components/HeroPattern';

export const description = 'ORIGIN / Internal Resources.';

export default function Home() {
    const { data: session, status } = useSession();
    const router = useRouter();

    useEffect(() => {
        // Capture SAML response if available in URL
        const urlParams = new URLSearchParams(window.location.search);
        const samlResponse = urlParams.get("samlResponse");

        if (samlResponse) {
            // Store SAML response securely in session storage
            sessionStorage.setItem("samlToken", samlResponse);
            router.replace("/"); // ✅ Remove SAML response from URL
        }
    }, []);

    if (status === "loading") {
        return (
            <div className="flex items-center justify-center min-h-screen bg-gray-100">
                <p className="text-gray-600 text-xl">Checking authentication...</p>
            </div>
        );
    }

    if (!session) {
        // Show the login button if the user is not signed in
        return (
            <div className="flex items-center justify-center min-h-screen bg-gradient-to-r from-blue-500 to-indigo-600 text-white">
                <div className="bg-white text-gray-900 p-8 rounded-2xl shadow-xl w-96 text-center">
                    <h1 className="text-3xl font-bold mb-4">Welcome to ORIGIN</h1>
                    <p className="mb-6 text-gray-600">Access internal resources securely with your Microsoft 365 account.</p>
                    <button
                        onClick={() => signIn("saml")}
                        className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl transition duration-300"
                    >
                        Sign In with Microsoft 365
                    </button>
                </div>
            </div>
        );
    }

    // Once the user is logged in, show the internal resource page
    return (
        <div>
            <HeroPattern />
            <h1>Internal Resources</h1>
            <p className="lead">Welcome, {session.user.name}!</p>
            <p className="lead">
                Welcome to the Origin Resource Hub - designed to streamline access to essential resources, enabling each of you to navigate your roles with enhanced efficiency.
            </p>
            <p className="lead">
                This hub is your go-to place for documents, training materials, and essential tools. It's designed to simplify your work life by putting everything you need right at your fingertips. Find what you're looking for and make the most of this handy resource. Your efficiency is our priority, and this hub is here to support your everyday tasks.
            </p>
            <p className="lead">
                Please let your supervisor know if there is something that you feel should be added as a resource. Thank you for your hard work and dedication.
            </p>

            <Guides />
            <Resources />

            <div className="mt-6">
                <button
                    onClick={() => signOut()}
                    className="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-xl transition duration-300"
                >
                    Sign Out
                </button>
            </div>
        </div>
    );
}
